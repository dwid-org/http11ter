<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type='text/xsl' href='../myxml2rfc.xslt'?>
<!DOCTYPE rfc [
  <!ENTITY MAY "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>MAY</bcp14>">
  <!ENTITY MUST "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>MUST</bcp14>">
  <!ENTITY MUST-NOT "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>MUST NOT</bcp14>">
  <!ENTITY OPTIONAL "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>OPTIONAL</bcp14>">
  <!ENTITY RECOMMENDED "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>RECOMMENDED</bcp14>">
  <!ENTITY REQUIRED "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>REQUIRED</bcp14>">
  <!ENTITY SHALL "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>SHALL</bcp14>">
  <!ENTITY SHALL-NOT "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>SHALL NOT</bcp14>">
  <!ENTITY SHOULD "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>SHOULD</bcp14>">
  <!ENTITY SHOULD-NOT "<bcp14 xmlns='http://purl.org/net/xml2rfc/ext'>SHOULD NOT</bcp14>">
  <!ENTITY ID-VERSION "latest">
  <!ENTITY ID-MONTH "July">
  <!ENTITY ID-YEAR "2010">
  <!ENTITY notation                   "<xref target='Part1' x:rel='#notation' xmlns:x='http://purl.org/net/xml2rfc/ext'/>">
  <!ENTITY notation-abnf              "<xref target='Part1' x:rel='#notation.abnf' xmlns:x='http://purl.org/net/xml2rfc/ext'/>">
  <!ENTITY basic-rules                "<xref target='Part1' x:rel='#basic.rules' xmlns:x='http://purl.org/net/xml2rfc/ext'/>">
  <!ENTITY full-date                  "<xref target='Part1' x:rel='#date.time.formats.full.date' xmlns:x='http://purl.org/net/xml2rfc/ext'/>">
  <!ENTITY messaging                  "<xref target='Part1' xmlns:x='http://purl.org/net/xml2rfc/ext'/>">
  <!ENTITY entity-tags                "<xref target='Part4' x:rel='#entity.tags' xmlns:x='http://purl.org/net/xml2rfc/ext'/>">
  <!ENTITY weak-and-strong-validators "<xref target='Part4' x:rel='#weak.and.strong.validators' xmlns:x='http://purl.org/net/xml2rfc/ext'/>">
]>
<?rfc toc="yes" ?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes"?>
<?rfc subcompact="no" ?>
<?rfc linkmailto="no" ?>
<?rfc editing="no" ?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc rfcedstyle="yes"?>
<?rfc-ext allow-markup-in-artwork="yes" ?>
<?rfc-ext include-references-in-index="yes" ?>
<rfc obsoletes="2616" category="std" x:maturity-level="draft"
     ipr="pre5378Trust200902" docName="draft-ietf-httpbis-p5-range-&ID-VERSION;"     xmlns:x='http://purl.org/net/xml2rfc/ext'>
<front>

  <title abbrev="HTTP/1.1, Part 5">HTTP/1.1, part 5: Range Requests and Partial Responses</title>

  <author initials="R." surname="Fielding" fullname="Roy T. Fielding" role="editor">
    <organization abbrev="Day Software">Day Software</organization>
    <address>
      <postal>
        <street>23 Corporate Plaza DR, Suite 280</street>
        <city>Newport Beach</city>
        <region>CA</region>
        <code>92660</code>
        <country>USA</country>
      </postal>
      <phone>+1-949-706-5300</phone>
      <facsimile>+1-949-706-5305</facsimile>
      <email>fielding@gbiv.com</email>
      <uri>http://roy.gbiv.com/</uri>
    </address>
  </author>

  <author initials="J." surname="Gettys" fullname="Jim Gettys">
    <organization abbrev="Alcatel-Lucent">Alcatel-Lucent Bell Labs</organization>
    <address>
      <postal>
        <street>21 Oak Knoll Road</street>
        <city>Carlisle</city>
        <region>MA</region>
        <code>01741</code>
        <country>USA</country>
      </postal>
      <email>jg@freedesktop.org</email>
      <uri>http://gettys.wordpress.com/</uri>
    </address>
  </author>
  
  <author initials="J." surname="Mogul" fullname="Jeffrey C. Mogul">
    <organization abbrev="HP">Hewlett-Packard Company</organization>
    <address>
      <postal>
        <street>HP Labs, Large Scale Systems Group</street>
        <street>1501 Page Mill Road, MS 1177</street>
        <city>Palo Alto</city>
        <region>CA</region>
        <code>94304</code>
        <country>USA</country>
      </postal>
      <email>JeffMogul@acm.org</email>
    </address>
  </author>

  <author initials="H." surname="Frystyk" fullname="Henrik Frystyk Nielsen">
    <organization abbrev="Microsoft">Microsoft Corporation</organization>
    <address>
      <postal>
        <street>1 Microsoft Way</street>
        <city>Redmond</city>
        <region>WA</region>
        <code>98052</code>
        <country>USA</country>
      </postal>
      <email>henrikn@microsoft.com</email>
    </address>
  </author>

  <author initials="L." surname="Masinter" fullname="Larry Masinter">
    <organization abbrev="Adobe Systems">Adobe Systems, Incorporated</organization>
    <address>
      <postal>
        <street>345 Park Ave</street>
        <city>San Jose</city>
        <region>CA</region>
        <code>95110</code>
        <country>USA</country>
      </postal>
      <email>LMM@acm.org</email>
      <uri>http://larry.masinter.net/</uri>
    </address>
  </author>
  
  <author initials="P." surname="Leach" fullname="Paul J. Leach">
    <organization abbrev="Microsoft">Microsoft Corporation</organization>
    <address>
      <postal>
        <street>1 Microsoft Way</street>
        <city>Redmond</city>
        <region>WA</region>
        <code>98052</code>
      </postal>
      <email>paulle@microsoft.com</email>
    </address>
  </author>
   
  <author initials="T." surname="Berners-Lee" fullname="Tim Berners-Lee">
    <organization abbrev="W3C/MIT">World Wide Web Consortium</organization>
    <address>
      <postal>
        <street>MIT Computer Science and Artificial Intelligence Laboratory</street>
        <street>The Stata Center, Building 32</street>
        <street>32 Vassar Street</street>
        <city>Cambridge</city>
        <region>MA</region>
        <code>02139</code>
        <country>USA</country>
      </postal>
      <email>timbl@w3.org</email>
      <uri>http://www.w3.org/People/Berners-Lee/</uri>
    </address>
  </author>

  <author initials="Y." surname="Lafon" fullname="Yves Lafon" role="editor">
    <organization abbrev="W3C">World Wide Web Consortium</organization>
    <address>
      <postal>
        <street>W3C / ERCIM</street>
        <street>2004, rte des Lucioles</street>
        <city>Sophia-Antipolis</city>
        <region>AM</region>
        <code>06902</code>
        <country>France</country>
      </postal>
      <email>ylafon@w3.org</email>
      <uri>http://www.raubacapeu.net/people/yves/</uri>
    </address>
  </author>

  <author initials="J. F." surname="Reschke" fullname="Julian F. Reschke" role="editor">
    <organization abbrev="greenbytes">greenbytes GmbH</organization>
    <address>
      <postal>
        <street>Hafenweg 16</street>
        <city>Muenster</city><region>NW</region><code>48155</code>
        <country>Germany</country>
      </postal>
      <phone>+49 251 2807760</phone>
      <facsimile>+49 251 2807761</facsimile>
      <email>julian.reschke@greenbytes.de</email>
      <uri>http://greenbytes.de/tech/webdav/</uri>
    </address>
  </author>

  <date month="&ID-MONTH;" year="&ID-YEAR;"/>
  <workgroup>HTTPbis Working Group</workgroup>

<abstract>
<t>
   The Hypertext Transfer Protocol (HTTP) is an application-level
   protocol for distributed, collaborative, hypermedia information
   systems. HTTP has been in use by the World Wide Web global information
   initiative since 1990. This document is Part 5 of the seven-part specification
   that defines the protocol referred to as "HTTP/1.1" and, taken together,
   obsoletes RFC 2616.  Part 5 defines range-specific requests and
   the rules for constructing and combining responses to those requests.
</t>
</abstract>

<note title="Editorial Note (To be removed by RFC Editor)">
  <t>
    Discussion of this draft should take place on the HTTPBIS working group
    mailing list (ietf-http-wg@w3.org). The current issues list is
    at <eref target="http://tools.ietf.org/wg/httpbis/trac/report/3"/>
    and related documents (including fancy diffs) can be found at
    <eref target="http://tools.ietf.org/wg/httpbis/"/>.
  </t>
  <t>
    The changes in this draft are summarized in <xref target="changes.since.10"/>.
  </t>
</note>
</front>
<middle>
<section title="Introduction" anchor="introduction">
<t>
   HTTP clients often encounter interrupted data transfers as a result
   of cancelled requests or dropped connections.  When a cache has stored
   a partial representation, it is desirable to request the remainder
   of that representation in a subsequent request rather than transfer
   the entire representation.
   There are also a number of Web applications that benefit from being
   able to request only a subset of a larger representation, such as a
   single page of a very large document or only part of an image to be
   rendered by a device with limited local storage.
</t>
<t>
   This document defines HTTP/1.1 range requests,
   partial responses, and the multipart/byteranges media type.
   The protocol for range requests is an &OPTIONAL; feature of HTTP,
   designed so resources or recipients that do not implement this feature
   can respond as if it is a normal GET request without impacting
   interoperability.  Partial responses are indicated by a distinct status
   code to not be mistaken for full responses by intermediate caches
   that might not implement the feature.
</t>
<t>
   Although the HTTP range request mechanism is designed to allow for
   extensible range types, this specification only defines requests for
   byte ranges.
</t>

<section title="Requirements" anchor="intro.requirements">
<t>
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <xref target="RFC2119"/>.
</t>
<t>
   An implementation is not compliant if it fails to satisfy one or more
   of the "MUST" or "REQUIRED" level requirements for the protocols it
   implements. An implementation that satisfies all the "MUST" or "REQUIRED"
   level and all the "SHOULD" level requirements for its protocols is said
   to be "unconditionally compliant"; one that satisfies all the "MUST"
   level requirements but not all the "SHOULD" level requirements for its
   protocols is said to be "conditionally compliant".
</t>
</section>

<section title="Syntax Notation" anchor="notation">
  <x:anchor-alias value="ALPHA"/>
  <x:anchor-alias value="CHAR"/>
  <x:anchor-alias value="CR"/>
  <x:anchor-alias value="DIGIT"/>
  <x:anchor-alias value="LF"/>
  <x:anchor-alias value="OCTET"/>
  <x:anchor-alias value="SP"/>
  <x:anchor-alias value="VCHAR"/>
  <x:anchor-alias value="WSP"/>
<t>
  This specification uses the ABNF syntax defined in &notation; (which
  extends the syntax defined in <xref target="RFC5234"/> with a list rule).
  <xref target="collected.abnf"/> shows the collected ABNF, with the list
  rule expanded.
</t>
<t>
  The following core rules are included by
  reference, as defined in <xref target="RFC5234" x:fmt="," x:sec="B.1"/>:
  ALPHA (letters), CR (carriage return), CRLF (CR LF), CTL (controls),
  DIGIT (decimal 0-9), DQUOTE (double quote),
  HEXDIG (hexadecimal 0-9/A-F/a-f), LF (line feed),
  OCTET (any 8-bit sequence of data), SP (space),
  VCHAR (any visible USASCII character),
  and WSP (whitespace).
</t>

<section title="Core Rules" anchor="core.rules">
  <x:anchor-alias value="token"/>
  <x:anchor-alias value="OWS"/>
<t>
  The core rules below are defined in &basic-rules;:
</t>
<figure><artwork type="abnf2616">
  <x:ref>token</x:ref>      = &lt;token, defined in &basic-rules;&gt;
  <x:ref>OWS</x:ref>        = &lt;OWS, defined in &basic-rules;&gt;
</artwork></figure>
</section>

<section title="ABNF Rules defined in other Parts of the Specification" anchor="abnf.dependencies">
  <x:anchor-alias value="entity-tag"/>
  <x:anchor-alias value="HTTP-date"/>
<t>
  The ABNF rules below are defined in other parts: 
</t>
<figure><!--Part1--><artwork type="abnf2616">
  <x:ref>HTTP-date</x:ref>  = &lt;HTTP-date, defined in &full-date;&gt;
</artwork></figure>
<figure><!--Part4--><artwork type="abnf2616">
  <x:ref>entity-tag</x:ref> = &lt;entity-tag, defined in &entity-tags;&gt;
</artwork></figure>
</section>

</section>

</section>


<section title="Range Units" anchor="range.units">
  <x:anchor-alias value="bytes-unit"/>
  <x:anchor-alias value="other-range-unit"/>
  <x:anchor-alias value="range-unit"/>
<t>
   HTTP/1.1 allows a client to request that only part (a range of) the
   representation be included within the response. HTTP/1.1 uses range
   units in the Range (<xref target="header.range"/>) and Content-Range (<xref target="header.content-range"/>)
   header fields. A representation can be broken down into subranges according
   to various structural units.
</t>
<figure><artwork type="abnf2616"><iref primary="true" item="Grammar" subitem="range-unit"/><iref primary="true" item="Grammar" subitem="bytes-unit"/><iref primary="true" item="Grammar" subitem="other-range-unit"/>
  <x:ref>range-unit</x:ref>       = <x:ref>bytes-unit</x:ref> / <x:ref>other-range-unit</x:ref>
  <x:ref>bytes-unit</x:ref>       = "bytes"
  <x:ref>other-range-unit</x:ref> = <x:ref>token</x:ref>
</artwork></figure>
<t>
  HTTP/1.1 has been designed to allow implementations of applications
  that do not depend on knowledge of ranges. The only range unit defined
  by HTTP/1.1 is "bytes".
</t>
<t>
  If a range unit is not understood in a request, a server &MUST; ignore
  the whole Range header (<xref target="header.range" />).
  If a range unit is not understood in a response, an intermediary 
  &SHOULD; pass the response to the client; a client &MUST; fail.
</t>
</section>

<section title="Status Code Definitions" anchor="status.code.definitions">
<section title="206 Partial Content" anchor="status.206">
  <iref primary="true" item="206 Partial Content (status code)" x:for-anchor=""/>
  <iref primary="true" item="Status Codes" subitem="206 Partial Content" x:for-anchor=""/>
<t>
   The server has fulfilled the partial GET request for the resource.
   The request &MUST; have included a Range header field (<xref target="header.range"/>)
   indicating the desired range, and &MAY; have included an If-Range
   header field (<xref target="header.if-range"/>) to make the request conditional.
</t>
<t>
   The response &MUST; include the following header fields:
  <list style="symbols">
    <t>
        Either a Content-Range header field (<xref target="header.content-range"/>) indicating
        the range included with this response, or a multipart/byteranges
        Content-Type including Content-Range fields for each part. If a
        Content-Length header field is present in the response, its
        value &MUST; match the actual number of octets transmitted in the
        message-body.
    </t>
    <t>
        Date
    </t>
    <t>
        Cache-Control, ETag, Expires, Content-Location, Last-Modified,
        and/or Vary, if the header field would have been sent in a 200
        response to the same request
    </t>
  </list>
</t>
<t>
   If the 206 response is the result of an If-Range request, the response
   &SHOULD-NOT; include other entity-headers. Otherwise, the response
   &MUST; include all of the entity-headers that would have been returned
   with a 200 (OK) response to the same request.
</t>
<t>
   A cache &MUST-NOT; combine a 206 response with other previously cached
   content if the ETag or Last-Modified headers do not match exactly,
   see <xref target="combining.byte.ranges"/>.
</t>
<t>
   A cache that does not support the Range and Content-Range headers
   &MUST-NOT; cache 206 (Partial Content) responses. Furthermore,
   if a response uses a range unit that is not understood by the cache,
   then it &MUST-NOT; be cached either. 
</t>
</section>

<section title="416 Requested Range Not Satisfiable" anchor="status.416">
  <iref primary="true" item="416 Requested Range Not Satisfiable (status code)" x:for-anchor=""/>
  <iref primary="true" item="Status Codes" subitem="416 Requested Range Not Satisfiable" x:for-anchor=""/>
<t>
   A server &SHOULD; return a response with this status code if a request
   included a Range request-header field (<xref target="header.range"/>), and none of
   the ranges-specifier values in this field overlap the current extent
   of the selected resource, and the request did not include an If-Range
   request-header field (<xref target="header.if-range"/>). (For byte-ranges,
   this means that the first-byte-pos of all of the byte-range-spec values were
   greater than the current length of the selected resource.)
</t>
<t>
   When this status code is returned for a byte-range request, the
   response &SHOULD; include a Content-Range entity-header field
   specifying the current length of the selected resource (see <xref target="header.content-range"/>).
   This response &MUST-NOT; use the multipart/byteranges content-type.
</t>
</section>
</section>

<section title="Combining Ranges" anchor="combining.byte.ranges">
<t>
   A response might transfer only a subrange of a representation, either because
   the request included one or more Range specifications, or because 
   a connection closed prematurely.
   After several such transfers, a cache might have received several 
   ranges of the same representation.
</t>
<t>
   If a cache has a stored non-empty set of subranges for a representation, and
   an incoming response transfers another subrange, the cache &MAY;
   combine the new subrange with the existing set if both the following
   conditions are met:
  <list style="symbols">
    <t>Both the incoming response and the cache entry have a cache
        validator.</t>
    <t>The two cache validators match using the strong comparison
        function (see &weak-and-strong-validators;).</t>
  </list>
</t>
<t>
   If either requirement is not met, the cache &MUST; use only the most
   recent partial response (based on the Date values transmitted with
   every response, and using the incoming response if these values are
   equal or missing), and &MUST; discard the other partial information.
</t>
</section>

<section title="Header Field Definitions" anchor="header.fields">
<t>
   This section defines the syntax and semantics of HTTP/1.1 header fields
   related to range requests and partial responses.
</t>
<t>
   For entity-header fields, both sender and recipient refer to either the
   client or the server, depending on who sends and who receives the message.
</t>

<section title="Accept-Ranges" anchor="header.accept-ranges">
  <iref primary="true" item="Accept-Ranges header" x:for-anchor=""/>
  <iref primary="true" item="Headers" subitem="Accept-Ranges" x:for-anchor=""/>
  <x:anchor-alias value="Accept-Ranges"/>
  <x:anchor-alias value="Accept-Ranges-v"/>
  <x:anchor-alias value="acceptable-ranges"/>
<t>
   The "Accept-Ranges" response-header field allows a resource to indicate
   its acceptance of range requests.
</t>
<figure><artwork type="abnf2616"><iref primary="true" item="Grammar" subitem="Accept-Ranges"/><iref primary="true" item="Grammar" subitem="Accept-Ranges-v"/><iref primary="true" item="Grammar" subitem="acceptable-ranges"/>
  <x:ref>Accept-Ranges</x:ref>     = "Accept-Ranges" ":" <x:ref>OWS</x:ref> <x:ref>Accept-Ranges-v</x:ref>
  <x:ref>Accept-Ranges-v</x:ref>   = <x:ref>acceptable-ranges</x:ref>
  <x:ref>acceptable-ranges</x:ref> = 1#<x:ref>range-unit</x:ref> / "none"
</artwork></figure>
<t>
      Origin servers that accept byte-range requests &MAY; send
</t>
<figure><artwork type="example">
  Accept-Ranges: bytes
</artwork></figure>
<t>
      but are not required to do so. Clients &MAY; generate range
      requests without having received this header for the resource
      involved. Range units are defined in <xref target="range.units"/>.
</t>
<t>
      Servers that do not accept any kind of range request for a
      resource &MAY; send
</t>
<figure><artwork type="example">
  Accept-Ranges: none
</artwork></figure>
<t>
      to advise the client not to attempt a range request.
</t>
</section>

<section title="Content-Range" anchor="header.content-range">
  <iref primary="true" item="Content-Range header" x:for-anchor=""/>
  <iref primary="true" item="Headers" subitem="Content-Range" x:for-anchor=""/>
  <x:anchor-alias value="byte-content-range-spec"/>
  <x:anchor-alias value="byte-range-resp-spec"/>
  <x:anchor-alias value="Content-Range"/>
  <x:anchor-alias value="Content-Range-v"/>
  <x:anchor-alias value="content-range-spec"/>
  <x:anchor-alias value="instance-length"/>
  <x:anchor-alias value="other-content-range-spec"/>
  <x:anchor-alias value="other-range-resp-spec"/>
<t>
   The "Content-Range" entity-header field is sent with a partial representation to
   specify where in the full representation the partial body should be
   applied. Range units are defined in <xref target="range.units"/>.
</t>
<figure><artwork type="abnf2616"><iref primary="true" item="Grammar" subitem="Content-Range"/><iref primary="true" item="Grammar" subitem="Content-Range-v"/><iref primary="true" item="Grammar" subitem="content-range-spec"/><iref primary="true" item="Grammar" subitem="byte-content-range-spec"/><iref primary="true" item="Grammar" subitem="byte-range-resp-spec"/><iref primary="true" item="Grammar" subitem="instance-length"/>
  <x:ref>Content-Range</x:ref> = "Content-Range" ":" <x:ref>OWS</x:ref> <x:ref>Content-Range-v</x:ref>
  <x:ref>Content-Range-v</x:ref> = <x:ref>content-range-spec</x:ref>
  
  <x:ref>content-range-spec</x:ref>      = <x:ref>byte-content-range-spec</x:ref>
                          / <x:ref>other-content-range-spec</x:ref>
  <x:ref>byte-content-range-spec</x:ref> = <x:ref>bytes-unit</x:ref> <x:ref>SP</x:ref>
                            <x:ref>byte-range-resp-spec</x:ref> "/"
                            ( <x:ref>instance-length</x:ref> / "*" )
  
  <x:ref>byte-range-resp-spec</x:ref>    = (<x:ref>first-byte-pos</x:ref> "-" <x:ref>last-byte-pos</x:ref>)
                          / "*"
                          
  <x:ref>instance-length</x:ref>         = 1*<x:ref>DIGIT</x:ref>
  
  <x:ref>other-content-range-spec</x:ref> = <x:ref>other-range-unit</x:ref> <x:ref>SP</x:ref>
                             <x:ref>other-range-resp-spec</x:ref>
  <x:ref>other-range-resp-spec</x:ref>    = *<x:ref>CHAR</x:ref>
</artwork></figure>
<t>
   The header &SHOULD; indicate the total length of the full representation,
   unless this length is unknown or difficult to determine. The asterisk
   "*" character means that the instance-length is unknown at the time
   when the response was generated.
</t>
<t>
   Unlike byte-ranges-specifier values (see <xref target="byte.ranges"/>), a byte-range-resp-spec
   &MUST; only specify one range, and &MUST; contain
   absolute byte positions for both the first and last byte of the
   range.
</t>
<t>
   A byte-content-range-spec with a byte-range-resp-spec whose last-byte-pos
   value is less than its first-byte-pos value, or whose
   instance-length value is less than or equal to its last-byte-pos
   value, is invalid. The recipient of an invalid byte-content-range-spec
   &MUST; ignore it and any content transferred along with it.
</t>
<t>
   In the case of a byte range request:
   A server sending a response with status code 416 (Requested range not
   satisfiable) &SHOULD; include a Content-Range field with a byte-range-resp-spec
   of "*". The instance-length specifies the current length of
   the selected resource. A response with status code 206 (Partial
   Content) &MUST-NOT; include a Content-Range field with a byte-range-resp-spec of "*".
</t>
<t>
   Examples of byte-content-range-spec values, assuming that the representation
   contains a total of 1234 bytes:
   <list style="symbols">
      <t>
        The first 500 bytes:
<figure><artwork type="example" x:indent-with="   ">
  bytes 0-499/1234
</artwork></figure>
      </t>    
      <t>
        The second 500 bytes:
<figure><artwork type="example" x:indent-with="   ">
  bytes 500-999/1234
</artwork></figure>
      </t>    
      <t>
        All except for the first 500 bytes:
<figure><artwork type="example" x:indent-with="   ">
  bytes 500-1233/1234
</artwork></figure>
      </t>    
      <t>
        The last 500 bytes:
<figure><artwork type="example" x:indent-with="   ">
  bytes 734-1233/1234
</artwork></figure>
      </t>    
   </list>
</t>
<t>
   When an HTTP message includes the content of a single range (for
   example, a response to a request for a single range, or to a request
   for a set of ranges that overlap without any holes), this content is
   transmitted with a Content-Range header, and a Content-Length header
   showing the number of bytes actually transferred. For example,
</t>
<figure><artwork type="example">
  HTTP/1.1 206 Partial Content
  Date: Wed, 15 Nov 1995 06:25:24 GMT
  Last-Modified: Wed, 15 Nov 1995 04:58:08 GMT
  Content-Range: bytes 21010-47021/47022
  Content-Length: 26012
  Content-Type: image/gif
</artwork></figure>
<t>
   When an HTTP message includes the content of multiple ranges (for
   example, a response to a request for multiple non-overlapping
   ranges), these are transmitted as a multipart message. The multipart
   media type used for this purpose is "multipart/byteranges" as defined
   in <xref target="internet.media.type.multipart.byteranges"/>.
</t>
<t>
   A response to a request for a single range &MUST-NOT; be sent using the
   multipart/byteranges media type.  A response to a request for
   multiple ranges, whose result is a single range, &MAY; be sent as a
   multipart/byteranges media type with one part. A client that cannot
   decode a multipart/byteranges message &MUST-NOT; ask for multiple
   ranges in a single request.
</t>
<t>
   When a client requests multiple ranges in one request, the
   server &SHOULD; return them in the order that they appeared in the
   request.
</t>
<t>
   If the server ignores a byte-range-spec because it is syntactically
   invalid, the server &SHOULD; treat the request as if the invalid Range
   header field did not exist. (Normally, this means return a 200
   response containing the full representation).
</t>
<t>
   If the server receives a request (other than one including an If-Range
   request-header field) with an unsatisfiable Range request-header
   field (that is, all of whose byte-range-spec values have a
   first-byte-pos value greater than the current length of the selected
   resource), it &SHOULD; return a response code of 416 (Requested range
   not satisfiable) (<xref target="status.416"/>).
</t>
<x:note>
  <t>
    <x:h>Note:</x:h> Clients cannot depend on servers to send a 416 (Requested
    range not satisfiable) response instead of a 200 (OK) response for
    an unsatisfiable Range request-header, since not all servers
    implement this request-header.
  </t>
</x:note>
</section>

<section title="If-Range" anchor="header.if-range">
  <iref primary="true" item="If-Range header" x:for-anchor=""/>
  <iref primary="true" item="Headers" subitem="If-Range" x:for-anchor=""/>
  <x:anchor-alias value="If-Range"/>
  <x:anchor-alias value="If-Range-v"/>
<t>
   If a client has a partial copy of a representation in its cache, and wishes
   to have an up-to-date copy of the entire representation in its cache, it
   could use the Range request-header with a conditional GET (using
   either or both of If-Unmodified-Since and If-Match.) However, if the
   condition fails because the representation has been modified, the client
   would then have to make a second request to obtain the entire current
   representation.
</t>
<t>
   The "If-Range" request-header field allows a client to "short-circuit" the second
   request. Informally, its meaning is "if the representation is unchanged, send
   me the part(s) that I am missing; otherwise, send me the entire new
   representation".
</t>
<figure><artwork type="abnf2616"><iref primary="true" item="Grammar" subitem="If-Range"/><iref primary="true" item="Grammar" subitem="If-Range-v"/>
  <x:ref>If-Range</x:ref>   = "If-Range" ":" <x:ref>OWS</x:ref> <x:ref>If-Range-v</x:ref>
  <x:ref>If-Range-v</x:ref> = <x:ref>entity-tag</x:ref> / <x:ref>HTTP-date</x:ref>
</artwork></figure>
<t>
   If the client has no entity-tag for a representation, but does have a Last-Modified
   date, it &MAY; use that date in an If-Range header. (The
   server can distinguish between a valid HTTP-date and any form of
   entity-tag by examining no more than two characters.) The If-Range
   header &SHOULD; only be used together with a Range header, and &MUST; be
   ignored if the request does not include a Range header, or if the
   server does not support the sub-range operation.
</t>
<t>
   If the entity-tag given in the If-Range header matches the current
   cache validator for the representation, then the server &SHOULD; provide the
   specified sub-range of the representation using a 206 (Partial Content)
   response. If the cache validator does not match, then the server &SHOULD;
   return the entire representation using a 200 (OK) response.
</t>
</section>

<section title="Range" anchor="header.range">
  <iref primary="true" item="Range header" x:for-anchor=""/>
  <iref primary="true" item="Headers" subitem="Range" x:for-anchor=""/>

<section title="Byte Ranges" anchor="byte.ranges">
<t>
   Since all HTTP representations are transferred as sequences
   of bytes, the concept of a byte range is meaningful for any HTTP
   representation. (However, not all clients and servers need to support byte-range
   operations.)
</t>
<t>
   Byte range specifications in HTTP apply to the sequence of bytes in
   the representation body (not necessarily the same as the message-body).
</t>
<t anchor="rule.ranges-specifier">
  <x:anchor-alias value="byte-range-set"/>
  <x:anchor-alias value="byte-range-spec"/>
  <x:anchor-alias value="byte-ranges-specifier"/>
  <x:anchor-alias value="first-byte-pos"/>
  <x:anchor-alias value="last-byte-pos"/>
  <x:anchor-alias value="ranges-specifier"/>
  <x:anchor-alias value="suffix-byte-range-spec"/>
  <x:anchor-alias value="suffix-length"/>

   A byte range operation &MAY; specify a single range of bytes, or a set
   of ranges within a single representation.
</t>
<figure><artwork type="abnf2616"><iref primary="true" item="Grammar" subitem="ranges-specifier"/><iref primary="true" item="Grammar" subitem="byte-ranges-specifier"/><iref primary="true" item="Grammar" subitem="byte-range-set"/><iref primary="true" item="Grammar" subitem="byte-range-spec"/><iref primary="true" item="Grammar" subitem="first-byte-pos"/><iref primary="true" item="Grammar" subitem="last-byte-pos"/>
  <x:ref>byte-ranges-specifier</x:ref> = <x:ref>bytes-unit</x:ref> "=" <x:ref>byte-range-set</x:ref>
  <x:ref>byte-range-set</x:ref>  = 1#( <x:ref>byte-range-spec</x:ref> / <x:ref>suffix-byte-range-spec</x:ref> )
  <x:ref>byte-range-spec</x:ref> = <x:ref>first-byte-pos</x:ref> "-" [ <x:ref>last-byte-pos</x:ref> ]
  <x:ref>first-byte-pos</x:ref>  = 1*<x:ref>DIGIT</x:ref>
  <x:ref>last-byte-pos</x:ref>   = 1*<x:ref>DIGIT</x:ref>
</artwork></figure>
<t>
   The first-byte-pos value in a byte-range-spec gives the byte-offset
   of the first byte in a range. The last-byte-pos value gives the
   byte-offset of the last byte in the range; that is, the byte
   positions specified are inclusive. Byte offsets start at zero.
</t>
<t>
   If the last-byte-pos value is present, it &MUST; be greater than or
   equal to the first-byte-pos in that byte-range-spec, or the byte-range-spec
   is syntactically invalid. The recipient of a byte-range-set
   that includes one or more syntactically invalid byte-range-spec
   values &MUST; ignore the header field that includes that byte-range-set.
</t>
<t>
   If the last-byte-pos value is absent, or if the value is greater than
   or equal to the current length of the representation body, last-byte-pos is
   taken to be equal to one less than the current length of the representation
   in bytes.
</t>
<t>
   By its choice of last-byte-pos, a client can limit the number of
   bytes retrieved without knowing the size of the representation.
</t>
<figure><artwork type="abnf2616"><iref primary="true" item="Grammar" subitem="suffix-byte-range-spec"/><iref primary="true" item="Grammar" subitem="suffix-length"/>
  <x:ref>suffix-byte-range-spec</x:ref> = "-" <x:ref>suffix-length</x:ref>
  <x:ref>suffix-length</x:ref> = 1*<x:ref>DIGIT</x:ref>
</artwork></figure>
<t>
   A suffix-byte-range-spec is used to specify the suffix of the
   representation body, of a length given by the suffix-length value. (That is,
   this form specifies the last N bytes of a representation.) If the
   representation is shorter than the specified suffix-length, the entire
   representation is used.
</t>
<t>
   If a syntactically valid byte-range-set includes at least one byte-range-spec
   whose first-byte-pos is less than the current length of
   the representation, or at least one suffix-byte-range-spec with a non-zero
   suffix-length, then the byte-range-set is satisfiable.
   Otherwise, the byte-range-set is unsatisfiable. If the byte-range-set
   is unsatisfiable, the server &SHOULD; return a response with a status
   of 416 (Requested range not satisfiable). Otherwise, the server
   &SHOULD; return a response with a status of 206 (Partial Content)
   containing the satisfiable ranges of the representation.
</t>
<t>
   Examples of byte-ranges-specifier values (assuming a representation of
   length 10000):
  <list style="symbols">
     <t>The first 500 bytes (byte offsets 0-499, inclusive):
<figure><artwork type="example" x:indent-with="   ">
  bytes=0-499
</artwork></figure>
    </t>
     <t>The second 500 bytes (byte offsets 500-999, inclusive):
<figure><artwork type="example" x:indent-with="   ">
  bytes=500-999
</artwork></figure>
    </t>
     <t>The final 500 bytes (byte offsets 9500-9999, inclusive):
<figure><artwork type="example" x:indent-with="   ">
  bytes=-500
</artwork></figure>
    Or:
<figure><artwork type="example" x:indent-with="   ">
  bytes=9500-
</artwork></figure>
    </t>
     <t>The first and last bytes only (bytes 0 and 9999):
<figure><artwork type="example" x:indent-with="   ">
  bytes=0-0,-1
</artwork></figure>
     </t>
     <t>Several legal but not canonical specifications of the second 500
        bytes (byte offsets 500-999, inclusive):
<figure><artwork type="example" x:indent-with="   ">
  bytes=500-600,601-999
  bytes=500-700,601-999
</artwork></figure>
     </t>
  </list>
</t>
</section>

<section title="Range Retrieval Requests" anchor="range.retrieval.requests">
  <x:anchor-alias value="Range"/>
  <x:anchor-alias value="Range-v"/>
  <x:anchor-alias value="other-ranges-specifier"/>
  <x:anchor-alias value="other-range-set"/>
<t>
   The "Range" request-header field defines the GET method (conditional or
   not) to request one or more sub-ranges of the response representation body, instead
   of the entire representation body.
</t>
<figure><artwork type="abnf2616"><iref primary="true" item="Grammar" subitem="Range"/>
  <x:ref>Range</x:ref>   = "Range" ":" <x:ref>OWS</x:ref> <x:ref>Range-v</x:ref>
  <x:ref>Range-v</x:ref> = <x:ref>byte-ranges-specifier</x:ref>
          / <x:ref>other-ranges-specifier</x:ref>
  <x:ref>other-ranges-specifier</x:ref> = <x:ref>other-range-unit</x:ref> "=" <x:ref>other-range-set</x:ref>
  <x:ref>other-range-set</x:ref> = 1*<x:ref>CHAR</x:ref>
</artwork></figure>
<t>
   A server &MAY; ignore the Range header. However, HTTP/1.1 origin
   servers and intermediate caches ought to support byte ranges when
   possible, since Range supports efficient recovery from partially
   failed transfers, and supports efficient partial retrieval of large
   representations.
</t>
<t>
   If the server supports the Range header and the specified range or
   ranges are appropriate for the representation:
  <list style="symbols">
     <t>The presence of a Range header in an unconditional GET modifies
        what is returned if the GET is otherwise successful. In other
        words, the response carries a status code of 206 (Partial
        Content) instead of 200 (OK).</t>

     <t>The presence of a Range header in a conditional GET (a request
        using one or both of If-Modified-Since and If-None-Match, or
        one or both of If-Unmodified-Since and If-Match) modifies what
        is returned if the GET is otherwise successful and the
        condition is true. It does not affect the 304 (Not Modified)
        response returned if the conditional is false.</t>
  </list>
</t>
<t>
   In some cases, it might be more appropriate to use the If-Range
   header (see <xref target="header.if-range"/>) in addition to the Range header.
</t>
<t>
   If a proxy that supports ranges receives a Range request, forwards
   the request to an inbound server, and receives an entire representation in
   reply, it &SHOULD; only return the requested range to its client. It
   &SHOULD; store the entire received response in its cache if that is
   consistent with its cache allocation policies.
</t>
</section>
</section>
</section>

<section title="IANA Considerations" anchor="IANA.considerations">

<section title="Status Code Registration" anchor="status.code.registration">
<t>
   The HTTP Status Code Registry located at <eref target="http://www.iana.org/assignments/http-status-codes"/>
   should be updated with the registrations below:
</t>
<?BEGININC p5-range.iana-status-codes ?>
<!--AUTOGENERATED FROM extract-status-code-defs.xslt, do not edit manually-->
<texttable align="left" suppress-title="true" anchor="iana.status.code.registration.table">
   <ttcol>Value</ttcol>
   <ttcol>Description</ttcol>
   <ttcol>Reference</ttcol>
   <c>206</c>
   <c>Partial Content</c>
   <c>
      <xref target="status.206"/>
   </c>
   <c>416</c>
   <c>Requested Range Not Satisfiable</c>
   <c>
      <xref target="status.416"/>
   </c>
</texttable>
<!--(END)-->
<?ENDINC p5-range.iana-status-codes ?>
</section>

<section title="Message Header Registration" anchor="message.header.registration">
<t>
   The Message Header Registry located at <eref target="http://www.iana.org/assignments/message-headers/message-header-index.html"/> should be updated
   with the permanent registrations below (see <xref target="RFC3864"/>):
</t>
<?BEGININC p5-range.iana-headers ?>
<!--AUTOGENERATED FROM extract-header-defs.xslt, do not edit manually-->
<texttable align="left" suppress-title="true" anchor="iana.header.registration.table">
   <ttcol>Header Field Name</ttcol>
   <ttcol>Protocol</ttcol>
   <ttcol>Status</ttcol>
   <ttcol>Reference</ttcol>

   <c>Accept-Ranges</c>
   <c>http</c>
   <c>standard</c>
   <c>
      <xref target="header.accept-ranges"/>
   </c>
   <c>Content-Range</c>
   <c>http</c>
   <c>standard</c>
   <c>
      <xref target="header.content-range"/>
   </c>
   <c>If-Range</c>
   <c>http</c>
   <c>standard</c>
   <c>
      <xref target="header.if-range"/>
   </c>
   <c>Range</c>
   <c>http</c>
   <c>standard</c>
   <c>
      <xref target="header.range"/>
   </c>
</texttable>
<!--(END)-->
<?ENDINC p5-range.iana-headers ?>
<t>
   The change controller is: "IETF (iesg@ietf.org) - Internet Engineering Task Force".
</t>
</section>
</section>

<section title="Security Considerations" anchor="security.considerations">
<t>
   No additional security considerations have been identified beyond
   those applicable to HTTP in general &messaging;.
</t>
</section>

<section title="Acknowledgments" anchor="ack">
<t>
   Most of the specification of ranges is based on work originally done
   by Ari Luotonen and John Franks, with additional input from Steve
   Zilles, Daniel W. Connolly, Roy T. Fielding, Jim Gettys, Martin Hamilton,
   Koen Holtman, Shel Kaplan, Paul Leach, Alex Lopez-Ortiz, Larry Masinter,
   Jeff Mogul, Lou Montulli, David W. Morris, Luigi Rizzo, and Bill Weihl.
</t>
</section>
</middle>
<back>

<references title="Normative References">

<reference anchor="Part1">
  <front>
    <title abbrev="HTTP/1.1">HTTP/1.1, part 1: URIs, Connections, and Message Parsing</title>
    <author initials="R." surname="Fielding" fullname="Roy T. Fielding" role="editor">
      <organization abbrev="Day Software">Day Software</organization>
      <address><email>fielding@gbiv.com</email></address>
    </author>
    <author initials="J." surname="Gettys" fullname="Jim Gettys">
      <organization abbrev="Alcatel-Lucent">Alcatel-Lucent Bell Labs</organization>
      <address><email>jg@freedesktop.org</email></address>
    </author>
    <author initials="J." surname="Mogul" fullname="Jeffrey C. Mogul">
      <organization abbrev="HP">Hewlett-Packard Company</organization>
      <address><email>JeffMogul@acm.org</email></address>
    </author>
    <author initials="H." surname="Frystyk" fullname="Henrik Frystyk Nielsen">
      <organization abbrev="Microsoft">Microsoft Corporation</organization>
      <address><email>henrikn@microsoft.com</email></address>
    </author>
    <author initials="L." surname="Masinter" fullname="Larry Masinter">
      <organization abbrev="Adobe Systems">Adobe Systems, Incorporated</organization>
      <address><email>LMM@acm.org</email></address>
    </author>
    <author initials="P." surname="Leach" fullname="Paul J. Leach">
      <organization abbrev="Microsoft">Microsoft Corporation</organization>
      <address><email>paulle@microsoft.com</email></address>
    </author>
    <author initials="T." surname="Berners-Lee" fullname="Tim Berners-Lee">
      <organization abbrev="W3C/MIT">World Wide Web Consortium</organization>
      <address><email>timbl@w3.org</email></address>
    </author>
    <author initials="Y." surname="Lafon" fullname="Yves Lafon" role="editor">
      <organization abbrev="W3C">World Wide Web Consortium</organization>
      <address><email>ylafon@w3.org</email></address>
    </author>
    <author initials="J. F." surname="Reschke" fullname="Julian F. Reschke" role="editor">
      <organization abbrev="greenbytes">greenbytes GmbH</organization>
      <address><email>julian.reschke@greenbytes.de</email></address>
    </author>
    <date month="&ID-MONTH;" year="&ID-YEAR;"/>
  </front>
  <seriesInfo name="Internet-Draft" value="draft-ietf-httpbis-p1-messaging-&ID-VERSION;"/>
  <x:source href="p1-messaging.xml" basename="p1-messaging"/>
</reference>

<reference anchor="Part4">
  <front>
    <title abbrev="HTTP/1.1">HTTP/1.1, part 4: Conditional Requests</title>
    <author initials="R." surname="Fielding" fullname="Roy T. Fielding" role="editor">
      <organization abbrev="Day Software">Day Software</organization>
      <address><email>fielding@gbiv.com</email></address>
    </author>
    <author initials="J." surname="Gettys" fullname="Jim Gettys">
      <organization abbrev="Alcatel-Lucent">Alcatel-Lucent Bell Labs</organization>
      <address><email>jg@freedesktop.org</email></address>
    </author>
    <author initials="J." surname="Mogul" fullname="Jeffrey C. Mogul">
      <organization abbrev="HP">Hewlett-Packard Company</organization>
      <address><email>JeffMogul@acm.org</email></address>
    </author>
    <author initials="H." surname="Frystyk" fullname="Henrik Frystyk Nielsen">
      <organization abbrev="Microsoft">Microsoft Corporation</organization>
      <address><email>henrikn@microsoft.com</email></address>
    </author>
    <author initials="L." surname="Masinter" fullname="Larry Masinter">
      <organization abbrev="Adobe Systems">Adobe Systems, Incorporated</organization>
      <address><email>LMM@acm.org</email></address>
    </author>
    <author initials="P." surname="Leach" fullname="Paul J. Leach">
      <organization abbrev="Microsoft">Microsoft Corporation</organization>
      <address><email>paulle@microsoft.com</email></address>
    </author>
    <author initials="T." surname="Berners-Lee" fullname="Tim Berners-Lee">
      <organization abbrev="W3C/MIT">World Wide Web Consortium</organization>
      <address><email>timbl@w3.org</email></address>
    </author>
    <author initials="Y." surname="Lafon" fullname="Yves Lafon" role="editor">
      <organization abbrev="W3C">World Wide Web Consortium</organization>
      <address><email>ylafon@w3.org</email></address>
    </author>
    <author initials="J. F." surname="Reschke" fullname="Julian F. Reschke" role="editor">
      <organization abbrev="greenbytes">greenbytes GmbH</organization>
      <address><email>julian.reschke@greenbytes.de</email></address>
    </author>
    <date month="&ID-MONTH;" year="&ID-YEAR;"/>
  </front>
  <seriesInfo name="Internet-Draft" value="draft-ietf-httpbis-p4-conditional-&ID-VERSION;"/>
  <x:source href="p4-conditional.xml" basename="p4-conditional"/>
</reference>

<reference anchor="RFC2046">
  <front>
    <title abbrev="Media Types">Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</title>
    <author initials="N." surname="Freed" fullname="Ned Freed">
      <organization>Innosoft International, Inc.</organization>
      <address><email>ned@innosoft.com</email></address>
    </author>
    <author initials="N." surname="Borenstein" fullname="Nathaniel S. Borenstein">
      <organization>First Virtual Holdings</organization>
      <address><email>nsb@nsb.fv.com</email></address>
    </author>
    <date month="November" year="1996"/>
  </front>
  <seriesInfo name="RFC" value="2046"/>
</reference>

<reference anchor="RFC2119">
  <front>
    <title>Key words for use in RFCs to Indicate Requirement Levels</title>
    <author initials="S." surname="Bradner" fullname="Scott Bradner">
      <organization>Harvard University</organization>
      <address><email>sob@harvard.edu</email></address>
    </author>
    <date month="March" year="1997"/>
  </front>
  <seriesInfo name="BCP" value="14"/>
  <seriesInfo name="RFC" value="2119"/>
</reference>

<reference anchor="RFC5234">
  <front>
    <title abbrev="ABNF for Syntax Specifications">Augmented BNF for Syntax Specifications: ABNF</title>
    <author initials="D." surname="Crocker" fullname="Dave Crocker" role="editor">
      <organization>Brandenburg InternetWorking</organization>
      <address>
        <email>dcrocker@bbiw.net</email>
      </address>  
    </author>
    <author initials="P." surname="Overell" fullname="Paul Overell">
      <organization>THUS plc.</organization>
      <address>
        <email>paul.overell@thus.net</email>
      </address>
    </author>
    <date month="January" year="2008"/>
  </front>
  <seriesInfo name="STD" value="68"/>
  <seriesInfo name="RFC" value="5234"/>
</reference>

</references>

<references title="Informative References">

<reference anchor="RFC2616">
  <front>
    <title>Hypertext Transfer Protocol -- HTTP/1.1</title>
    <author initials="R." surname="Fielding" fullname="R. Fielding">
      <organization>University of California, Irvine</organization>
      <address><email>fielding@ics.uci.edu</email></address>
    </author>
    <author initials="J." surname="Gettys" fullname="J. Gettys">
      <organization>W3C</organization>
      <address><email>jg@w3.org</email></address>
    </author>
    <author initials="J." surname="Mogul" fullname="J. Mogul">
      <organization>Compaq Computer Corporation</organization>
      <address><email>mogul@wrl.dec.com</email></address>
    </author>
    <author initials="H." surname="Frystyk" fullname="H. Frystyk">
      <organization>MIT Laboratory for Computer Science</organization>
      <address><email>frystyk@w3.org</email></address>
    </author>
    <author initials="L." surname="Masinter" fullname="L. Masinter">
      <organization>Xerox Corporation</organization>
      <address><email>masinter@parc.xerox.com</email></address>
    </author>
    <author initials="P." surname="Leach" fullname="P. Leach">
      <organization>Microsoft Corporation</organization>
      <address><email>paulle@microsoft.com</email></address>
    </author>
    <author initials="T." surname="Berners-Lee" fullname="T. Berners-Lee">
      <organization>W3C</organization>
      <address><email>timbl@w3.org</email></address>
    </author>
    <date month="June" year="1999"/>
  </front>
  <seriesInfo name="RFC" value="2616"/>
</reference>

<reference anchor='RFC3864'>
  <front>
    <title>Registration Procedures for Message Header Fields</title>
    <author initials='G.' surname='Klyne' fullname='G. Klyne'>
      <organization>Nine by Nine</organization>
      <address><email>GK-IETF@ninebynine.org</email></address>
    </author>
    <author initials='M.' surname='Nottingham' fullname='M. Nottingham'>
      <organization>BEA Systems</organization>
      <address><email>mnot@pobox.com</email></address>
    </author>
    <author initials='J.' surname='Mogul' fullname='J. Mogul'>
      <organization>HP Labs</organization>
      <address><email>JeffMogul@acm.org</email></address>
    </author>
    <date year='2004' month='September' />
  </front>
  <seriesInfo name='BCP' value='90' />
  <seriesInfo name='RFC' value='3864' />
</reference>

<reference anchor="RFC4288">
  <front>
    <title>Media Type Specifications and Registration Procedures</title>
    <author initials="N." surname="Freed" fullname="N. Freed">
      <organization>Sun Microsystems</organization>
      <address>
        <email>ned.freed@mrochek.com</email>
      </address>
    </author>
    <author initials="J." surname="Klensin" fullname="J. Klensin">
      <address>
        <email>klensin+ietf@jck.com</email>
      </address>
    </author>
    <date year="2005" month="December"/>
  </front>
  <seriesInfo name="BCP" value="13"/>
  <seriesInfo name="RFC" value="4288"/>
</reference>

</references>

<section title="Internet Media Type multipart/byteranges" anchor="internet.media.type.multipart.byteranges">
<iref item="Media Type" subitem="multipart/byteranges" primary="true"/>
<iref item="multipart/byteranges Media Type" primary="true"/>
<t>
   When an HTTP 206 (Partial Content) response message includes the
   content of multiple ranges (a response to a request for multiple
   non-overlapping ranges), these are transmitted as a multipart
   message-body (<xref target="RFC2046" x:fmt="," x:sec="5.1"/>). The media type for this purpose is called
   "multipart/byteranges".  The following is to be registered with IANA <xref target="RFC4288"/>.
</t>
<x:note>
  <t>
    <x:h>Note:</x:h> Despite the name "multipart/byteranges" is not limited to the byte ranges only.
  </t>
</x:note>
<t>
   The multipart/byteranges media type includes one or more parts, each
   with its own Content-Type and Content-Range fields. The required
   boundary parameter specifies the boundary string used to separate
   each body-part.
</t>
<t>
  <list style="hanging" x:indent="12em">
    <t hangText="Type name:">
      multipart
    </t>
    <t hangText="Subtype name:">
      byteranges
    </t>
    <t hangText="Required parameters:">
      boundary
    </t>
    <t hangText="Optional parameters:">
      none
    </t>
    <t hangText="Encoding considerations:">
      only "7bit", "8bit", or "binary" are permitted
    </t>
    <t hangText="Security considerations:">
      none
    </t>
    <t hangText="Interoperability considerations:">
      none
    </t>
    <t hangText="Published specification:">
      This specification (see <xref target="internet.media.type.multipart.byteranges"/>).
    </t>
    <t hangText="Applications that use this media type:">
    </t>
    <t hangText="Additional information:">
      <list style="hanging">
        <t hangText="Magic number(s):">none</t>
        <t hangText="File extension(s):">none</t>
        <t hangText="Macintosh file type code(s):">none</t>
      </list>
    </t>
    <t hangText="Person and email address to contact for further information:">
      See Authors Section.
    </t>
    <t hangText="Intended usage:">
      COMMON
    </t>
    <t hangText="Restrictions on usage:">
      none
    </t>
    <t hangText="Author/Change controller:">
      IESG
    </t>
  </list>
</t>
<figure><preamble>
   For example:
</preamble><artwork type="example">
  HTTP/1.1 206 Partial Content
  Date: Wed, 15 Nov 1995 06:25:24 GMT
  Last-Modified: Wed, 15 Nov 1995 04:58:08 GMT
  Content-type: multipart/byteranges; boundary=THIS_STRING_SEPARATES
  
  --THIS_STRING_SEPARATES
  Content-type: application/pdf
  Content-range: bytes 500-999/8000
  
  ...the first range...
  --THIS_STRING_SEPARATES
  Content-type: application/pdf
  Content-range: bytes 7000-7999/8000
  
  ...the second range
  --THIS_STRING_SEPARATES--
</artwork></figure>
<figure><preamble>
   Other example:
</preamble>
<artwork type="example">
  HTTP/1.1 206 Partial Content
  Date: Tue, 14 Nov 1995 06:25:24 GMT
  Last-Modified: Tue, 14 July 04:58:08 GMT
  Content-type: multipart/byteranges; boundary=THIS_STRING_SEPARATES
  
  --THIS_STRING_SEPARATES
  Content-type: video/example
  Content-range: exampleunit 1.2-4.3/25
  
  ...the first range...
  --THIS_STRING_SEPARATES
  Content-type: video/example
  Content-range: exampleunit 11.2-14.3/25
  
  ...the second range
  --THIS_STRING_SEPARATES--
</artwork>
</figure>
<t>
      Notes:
  <list style="numbers">
      <t>Additional CRLFs &MAY; precede the first boundary string in the body.</t>

      <t>Although <xref target="RFC2046"/> permits the boundary string to be
         quoted, some existing implementations handle a quoted boundary
         string incorrectly.</t>

      <t>A number of browsers and servers were coded to an early draft
         of the byteranges specification to use a media type of
         multipart/x-byteranges<iref item="multipart/x-byteranges Media Type"/><iref item="Media Type" subitem="multipart/x-byteranges"/>, which is almost, but not quite
         compatible with the version documented in HTTP/1.1.</t>
  </list>
</t>
</section>

<section title="Compatibility with Previous Versions" anchor="compatibility">
<section title="Changes from RFC 2616" anchor="changes.from.rfc.2616">
<t>
  Clarify that it is not ok to use a weak cache validator in a 206 response.
  (<xref target="status.206"/>)
</t>
<t>
  Clarify that multipart/byteranges can consist of a single part.
  (<xref target="internet.media.type.multipart.byteranges"/>)
</t>

</section>

</section>

<?BEGININC p5-range.abnf-appendix ?>
<section xmlns:x="http://purl.org/net/xml2rfc/ext" title="Collected ABNF" anchor="collected.abnf">
<figure>
<artwork type="abnf" name="p5-range.parsed-abnf">
<x:ref>Accept-Ranges</x:ref> = "Accept-Ranges:" OWS Accept-Ranges-v
<x:ref>Accept-Ranges-v</x:ref> = acceptable-ranges

<x:ref>Content-Range</x:ref> = "Content-Range:" OWS Content-Range-v
<x:ref>Content-Range-v</x:ref> = content-range-spec

<x:ref>HTTP-date</x:ref> = &lt;HTTP-date, defined in [Part1], Section 6.1&gt;

<x:ref>If-Range</x:ref> = "If-Range:" OWS If-Range-v
<x:ref>If-Range-v</x:ref> = entity-tag / HTTP-date

<x:ref>OWS</x:ref> = &lt;OWS, defined in [Part1], Section 1.2.2&gt;

<x:ref>Range</x:ref> = "Range:" OWS Range-v
<x:ref>Range-v</x:ref> = byte-ranges-specifier / other-ranges-specifier

<x:ref>acceptable-ranges</x:ref> = ( *( "," OWS ) range-unit *( OWS "," [ OWS
 range-unit ] ) ) / "none"

<x:ref>byte-content-range-spec</x:ref> = bytes-unit SP byte-range-resp-spec "/" (
 instance-length / "*" )
<x:ref>byte-range-resp-spec</x:ref> = ( first-byte-pos "-" last-byte-pos ) / "*"
<x:ref>byte-range-set</x:ref> = ( *( "," OWS ) byte-range-spec ) / (
 suffix-byte-range-spec *( OWS "," [ ( OWS byte-range-spec ) /
 suffix-byte-range-spec ] ) )
<x:ref>byte-range-spec</x:ref> = first-byte-pos "-" [ last-byte-pos ]
<x:ref>byte-ranges-specifier</x:ref> = bytes-unit "=" byte-range-set
<x:ref>bytes-unit</x:ref> = "bytes"

<x:ref>content-range-spec</x:ref> = byte-content-range-spec /
 other-content-range-spec

<x:ref>entity-tag</x:ref> = &lt;entity-tag, defined in [Part4], Section 2&gt;

<x:ref>first-byte-pos</x:ref> = 1*DIGIT

<x:ref>instance-length</x:ref> = 1*DIGIT

<x:ref>last-byte-pos</x:ref> = 1*DIGIT

<x:ref>other-content-range-spec</x:ref> = other-range-unit SP other-range-resp-spec
<x:ref>other-range-resp-spec</x:ref> = *CHAR
<x:ref>other-range-set</x:ref> = 1*CHAR
<x:ref>other-range-unit</x:ref> = token
<x:ref>other-ranges-specifier</x:ref> = other-range-unit "=" other-range-set

<x:ref>range-unit</x:ref> = bytes-unit / other-range-unit

<x:ref>suffix-byte-range-spec</x:ref> = "-" suffix-length
<x:ref>suffix-length</x:ref> = 1*DIGIT

<x:ref>token</x:ref> = &lt;token, defined in [Part1], Section 1.2.2&gt;
</artwork>
</figure>
<figure><preamble>ABNF diagnostics:</preamble><artwork type="inline">
; Accept-Ranges defined but not used
; Content-Range defined but not used
; If-Range defined but not used
; Range defined but not used
</artwork></figure></section>
<?ENDINC p5-range.abnf-appendix ?>


<section title="Change Log (to be removed by RFC Editor before publication)" anchor="change.log">

<section title="Since RFC2616">
<t>
  Extracted relevant partitions from <xref target="RFC2616"/>.
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-00">
<t>
  Closed issues:
  <list style="symbols"> 
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/18"/>:
      "Cache validators in 206 responses"
      (<eref target="http://purl.org/NET/http-errata#ifrange206"/>)
    </t>
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/35"/>:
      "Normative and Informative references"
    </t>
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/86"/>:
      "Normative up-to-date references"
    </t>
  </list>
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-01">
<t>
  Closed issues:
  <list style="symbols"> 
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/55"/>:
      "Updating to RFC4288"
    </t>
  </list>
</t>
<t>
  Ongoing work on ABNF conversion (<eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/36"/>):
  <list style="symbols"> 
    <t>
      Add explicit references to BNF syntax and rules imported from other parts of the specification.
    </t>
  </list>
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-02" anchor="changes.since.02">
<t>
  Ongoing work on IANA Message Header Registration (<eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/40"/>):
  <list style="symbols"> 
    <t>
      Reference RFC 3984, and update header registrations for headers defined
      in this document.
    </t>
  </list>
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-03" anchor="changes.since.03">
<t>
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-04" anchor="changes.since.04">
<t>
  Closed issues:
  <list style="symbols"> 
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/133"/>:
      "multipart/byteranges minimum number of parts"
    </t>
  </list>
</t>
<t>
  Ongoing work on ABNF conversion (<eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/36"/>):
  <list style="symbols"> 
    <t>
      Use "/" instead of "|" for alternatives.
    </t>
    <t>
      Introduce new ABNF rules for "bad" whitespace ("BWS"), optional
      whitespace ("OWS") and required whitespace ("RWS").
    </t>
    <t>
      Rewrite ABNFs to spell out whitespace rules, factor out
      header value format definitions.
    </t>
  </list>
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-05" anchor="changes.since.05">
<t>
  Closed issues:
  <list style="symbols"> 
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/142"/>:
      "State base for *-byte-pos and suffix-length"
    </t>
  </list>
</t>
<t>
  Ongoing work on Custom Ranges (<eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/85"/>):
  <list style="symbols"> 
    <t>
      Remove bias in favor of byte ranges; allow custom ranges in ABNF.
    </t>
  </list>
</t>
<t>
  Final work on ABNF conversion (<eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/36"/>):
  <list style="symbols"> 
    <t>
      Add appendix containing collected and expanded ABNF, reorganize ABNF introduction.
    </t>
  </list>
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-06" anchor="changes.since.06">
<t>
  Closed issues:
  <list style="symbols"> 
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/161"/>:
      "base for numeric protocol elements"
    </t>
  </list>
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-07" anchor="changes.since.07">
<t>
  Closed issues:
  <list style="symbols">
    <t>
      Fixed discrepancy in the If-Range definition about allowed validators.
    </t>
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/150" />: "multipart/byteranges for custom range units"
    </t>
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/151" />: "range unit missing from other-ranges-specifier in Range header"
    </t>
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/198"/>:
      "move IANA registrations for optional status codes"
    </t>
  </list>
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-08" anchor="changes.since.08">
<t>
  No significant changes.
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-09" anchor="changes.since.09">
<t>
 No significant changes.
</t>
</section>

<section title="Since draft-ietf-httpbis-p5-range-10" anchor="changes.since.10">
<t>
  Closed issues:
  <list style="symbols"> 
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/69"/>:
      "Clarify 'Requested Variant'"
    </t>
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/109"/>:
      "Clarify entity / representation / variant terminology"
    </t>
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/220"/>:
      "Clarify entity / representation / variant terminology"
    </t>
    <t>
      <eref target="http://tools.ietf.org/wg/httpbis/trac/ticket/220"/>:
      "consider removing the 'changes from 2068' sections"
    </t>
  </list>
</t>
</section>

</section>

</back>
</rfc>
